name: Publish
on:
  push:
    tags:
        - 'v*'

jobs:

  test:
    name: testing
    uses: yankeeinlondon/gha/.github/workflows/test.yml@main
    permissions:
      contents: read
      id-token: write

  publish:
    name: publish
    needs: test  # This ensures tests pass before publishing
    uses: yankeeinlondon/gha/.github/workflows/publish.yml@main
    permissions:
      contents: read
      id-token: write
      packages: write
    with:
        jsr_scope: '@yankeeinlondon'
        github_packages_scope: '@yankeeinlondon'
    secrets:
        NPM_TOKEN: ${{ secrets.NPM_TOKEN }}

